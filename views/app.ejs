<!DOCTYPE html>
<html lang="ja">
<head>
  <link rel="stylesheet" href="stylesheets/style.css">
  <script src=http://localhost:8000/js/jquery-3.3.1.min.js></script>
  <title>Document</title>
</head>
<body>

  <form action="/" method="POST">
    <input type="text" name="content" id="content" autocomplete="off">
    <button id="tweet-button">はなす</button>
  </form>
  <div id="tweets-container">
  </div>
<h6><a href="/logout">LOGOUT</a></h6>

<script> // input が空欄の時は送信したくない
  const tweets = <%- JSON.stringify(tweets.map(tweet => {
    return {author: {username: tweet.author.username}, content: tweet.content, tweetedAt: tweet.tweetedAt}
  })) %>
  tweets.forEach(createContentBoard)

  function createContentBoard(tweet) {
    const $followButton =$("<button>フォロー</button>").addClass("follow-button")
    $('<p></p>').addClass("contentboard")
    .append(tweet.author.username)
    .append('<br>')
    .append(tweet.content)
    .append('<br>')
    .append($followButton)
    .append('<br>')
    .append(tweet.tweetedAt)
    .prependTo($('#tweets-container'))
  }

  $("#tweet-button").click(function (event) {
    event.preventDefault()
    $.ajax({
      url: "/",
      type: "POST",
      data: $("#content").serialize(),
      datType: "json",
      success: function (res) {
        createContentBoard(res)
        $("#content").val("")
      }
    })
  })
</script>
</body>
</html>